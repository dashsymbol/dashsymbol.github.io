
const translations = {
    en: {
        skip_link: "Skip to main content",
        nav_home: "Home",
        nav_projects: "Projects",
        nav_gallery: "Gallery",
        nav_about: "About",
        nav_skills: "Skills",
        nav_testimonials: "Testimonials",
        nav_contact: "Contact",
        hero_intro: "Hello, I am",
        hero_title: "Visual Designer",
        hero_tagline: "Crafting digital experiences with precision, clarity, and purpose.",
        btn_projects: "View Projects",
        btn_resume: "Download Resume",
        btn_email: "Email Me",
        section_projects: "Featured Projects",
        proj_cat_branding: "Branding",
        proj_cat_ui: "UI Design",
        proj_cat_packaging: "Packaging",
        proj_cat_motion: "Motion",
        proj_cat_editorial: "Editorial",
        proj_cat_illustration: "Illustration",
        p1_title: "Ahrepa",
        p1_desc: "Vibrant brand identity and packaging design for an artisanal food brand.",
        p2_title: "Lumina Dashboard",
        p2_desc: "Designed a comprehensive analytics dashboard for solar energy monitoring with dark mode support.",
        p3_title: "Botanica Brews",
        p3_desc: "Label design and packaging system for an organic coffee roastery based in the Pacific Northwest.",
        p4_title: "Kinetic Type Series",
        p4_desc: "An exploration of expressive typography through motion, created for a digital arts exhibition.",
        p5_title: "Vantage Magazine",
        p5_desc: "Layout and art direction for a quarterly lifestyle publication, emphasizing white space and typography.",
        p6_title: "City Icons",
        p6_desc: "A set of vector icons representing landmark buildings in Tulsa, used for local tourism guides.",
        link_case_study: "View Case Study",
        section_gallery: "Visual Gallery",
        gallery_cap_1: "Abstract Geo",
        gallery_cap_2: "Neon Type",
        gallery_cap_3: "Print Mockup",
        gallery_cap_4: "Dark UI",
        gallery_cap_5: "3D Render",
        gallery_cap_6: "Icon Set",
        gallery_cap_7: "Color Study",
        gallery_cap_8: "Poster Art",
        section_about: "About Me",
        about_p1: "I am a multidisciplinary visual designer with a passion for minimal aesthetics and functional design. My work bridges the gap between structured typography and fluid creativity.",
        about_p2: "With over 5 years of experience in both digital and print mediums, I help brands communicate their values through clarity and intention. I believe that good design is invisible—it just works.",
        about_location: "Currently based in Tulsa, OK.",
        section_skills: "Tools & Skills",
        section_testimonials: "Testimonials",
        quote_1: "\"Dash has an incredible eye for detail. The rebranding project completely revitalized our customer perception.\"",
        role_1: "Marketing Director, Apex Arch",
        quote_2: "\"Professional, timely, and bilingual skills were a huge asset for our international campaign launch.\"",
        role_2: "Product Lead, Lumina Tech",
        quote_3: "\"The designs were clean, modern, and exactly what we needed. Highly recommended for any UI work.\"",
        role_3: "Founder, StartUp flow",
        contact_title: "Let's Work Together",
        contact_text: "Open to full-time roles and collaborations. If you have a project in mind, feel free to reach out.",
        nav_contact_btn: "Contact",
        footer_rights: "All rights reserved.",
        modal_summary: "Summary",
        modal_role: "Role & Responsibilities",
        modal_tools: "Tools Used",
        modal_process: "Process"
    },
    es: {
        skip_link: "Saltar al contenido principal",
        nav_home: "Inicio",
        nav_projects: "Proyectos",
        nav_gallery: "Galería",
        nav_about: "Sobre Mí",
        nav_skills: "Habilidades",
        nav_testimonials: "Testimonios",
        nav_contact: "Contacto",
        hero_intro: "Hola, soy",
        hero_title: "Diseñadora Visual",
        hero_tagline: "Creando experiencias digitales con precisión, claridad y propósito.",
        btn_projects: "Ver Proyectos",
        btn_resume: "Descargar CV",
        btn_email: "Envíame un Email",
        section_projects: "Proyectos Destacados",
        proj_cat_branding: "Branding",
        proj_cat_ui: "Diseño UI",
        proj_cat_packaging: "Packaging",
        proj_cat_motion: "Motion Graphics",
        proj_cat_editorial: "Editorial",
        proj_cat_illustration: "Ilustración",
        p1_title: "Ahrepa",
        p1_desc: "Identidad de marca vibrante y diseño de empaque para una marca de comida artesanal.",
        p2_title: "Lumina Dashboard",
        p2_desc: "Diseño de un panel de análisis integral para monitoreo de energía solar con soporte para modo oscuro.",
        p3_title: "Botanica Brews",
        p3_desc: "Diseño de etiquetas y sistema de empaque para una tostaduría de café orgánico con base en el Noroeste del Pacífico.",
        p4_title: "Kinetic Type Series",
        p4_desc: "Una exploración de tipografía expresiva a través del movimiento, creada para una exhibición de arte digital.",
        p5_title: "Vantage Magazine",
        p5_desc: "Diseño y dirección de arte para una publicación trimestral de estilo de vida, enfatizando el espacio en blanco y la tipografía.",
        p6_title: "City Icons",
        p6_desc: "Un set de iconos vectoriales representando edificios emblemáticos de Tulsa, usados para guías de turismo local.",
        link_case_study: "Ver Caso de Estudio",
        section_gallery: "Galería Visual",
        gallery_cap_1: "Geo Abstracto",
        gallery_cap_2: "Tipo Neón",
        gallery_cap_3: "Mockup Impreso",
        gallery_cap_4: "UI Oscura",
        gallery_cap_5: "Render 3D",
        gallery_cap_6: "Set de Iconos",
        gallery_cap_7: "Estudio de Color",
        gallery_cap_8: "Arte de Poster",
        section_about: "Sobre Mí",
        about_p1: "Soy una diseñadora visual multidisciplinaria con pasión por la estética minimalista y el diseño funcional. Mi trabajo une el puente entre la tipografía estructurada y la creatividad fluida.",
        about_p2: "Con más de 5 años de experiencia en medios digitales e impresos, ayudo a las marcas a comunicar sus valores a través de la claridad y la intención. Creo que el buen diseño es invisible—simplemente funciona.",
        about_location: "Actualmente basada en Tulsa, OK.",
        section_skills: "Herramientas y Habilidades",
        section_testimonials: "Testimonios",
        quote_1: "\"Dash tiene un ojo increíble para los detalles. El proyecto de rebranding revitalizó completamente la percepción de nuestros clientes.\"",
        role_1: "Director de Marketing, Apex Arch",
        quote_2: "\"Profesional, puntual y sus habilidades bilingües fueron un gran activo para el lanzamiento de nuestra campaña internacional.\"",
        role_2: "Líder de Producto, Lumina Tech",
        quote_3: "\"Los diseños fueron limpios, modernos y exactamente lo que necesitábamos. Altamente recomendado para cualquier trabajo de UI.\"",
        role_3: "Fundadora, StartUp flow",
        contact_title: "Trabajemos Juntos",
        contact_text: "Disponible para roles de tiempo completo y colaboraciones. Si tienes un proyecto en mente, no dudes en contactarme.",
        nav_contact_btn: "Contacto",
        footer_rights: "Todos los derechos reservados.",
        modal_summary: "Resumen",
        modal_role: "Rol y Responsabilidades",
        modal_tools: "Herramientas",
        modal_process: "Proceso"
    }
};

// PROJECT DATA
const projectsData = {
    "ahrepa": {
        slug: "ahrepa",
        images: [1, 2, 3, 4, 5, 6, 7, 8],
        content: {
            en: {
                title: "Ahrepa",
                category: "Branding",
                summary: "Developed a vibrant and authentic brand identity for Ahrepa, focusing on conveying the warmth and tradition of artisanal cuisine through modern design.",
                role: "Lead Designer. Responsible for logo design, packaging, and brand guidelines.",
                tools: ["Adobe Illustrator", "Photoshop", "InDesign"],
                process: [
                    "Researching cultural motifs and color palettes.",
                    "Sketching logo concepts focusing on organic shapes.",
                    "Developing a flexible packaging system for various products.",
                    "Creating marketing assets for launch."
                ]
            },
            es: {
                title: "Ahrepa",
                category: "Branding",
                summary: "Desarrollé una identidad de marca vibrante y auténtica para Ahrepa, enfocándome en transmitir la calidez y tradición de la cocina artesanal a través de un diseño moderno.",
                role: "Diseñadora Principal. Responsable del logo, empaques y guías de marca.",
                tools: ["Adobe Illustrator", "Photoshop", "InDesign"],
                process: [
                    "Investigación de motivos culturales y paletas de color.",
                    "Bocetaje de conceptos de logo enfocados en formas orgánicas.",
                    "Desarrollo de un sistema de empaque flexible para varios productos.",
                    "Creación de activos de marketing para el lanzamiento."
                ]
            }
        }
    },
    "lumina-dashboard": {
        slug: "lumina-dashboard",
        images: [1, 2, 3, 4],
        content: {
            en: {
                title: "Lumina Dashboard",
                category: "UI Design",
                summary: "Designed a B2B analytics dashboard for solar energy management. The main challenge was presenting complex data sets clearly while allowing users to toggle between day and night modes for field visibility.",
                role: "UI/UX Designer. Handled wireframing, high-fidelity prototyping, and developer handoff.",
                tools: ["Figma", "Protopie", "Design Systems"],
                process: [
                    "Analyzed user personas (maintenance engineers and system admins).",
                    "Created low-fidelity wireframes to map user flows.",
                    "Designed a component library with strict accessibility standards (WCAG 2.1).",
                    "Iterated on data visualization widgets based on user testing feedback."
                ]
            },
            es: {
                title: "Lumina Dashboard",
                category: "Diseño UI",
                summary: "Diseñé un panel de análisis B2B para la gestión de energía solar. El desafío principal fue presentar conjuntos de datos complejos claramente mientras se permitía a los usuarios cambiar entre modos diurno y nocturno para visibilidad en campo.",
                role: "Diseñadora UI/UX. A cargo del wireframing, prototipado de alta fidelidad y entrega a desarrolladores.",
                tools: ["Figma", "Protopie", "Design Systems"],
                process: [
                    "Análisis de personas usuarias (ingenieros de mantenimiento y administradores de sistema).",
                    "Creación de wireframes de baja fidelidad para mapear flujos de usuarios.",
                    "Diseño de una biblioteca de componentes con estrictos estándares de accesibilidad (WCAG 2.1).",
                    "Iteración en widgets de visualización de datos basada en feedback de pruebas de usuario."
                ]
            }
        }
    },
    "botanica-brews": {
        slug: "botanica-brews",
        images: [1, 2, 3],
        content: {
            en: {
                title: "Botanica Brews",
                category: "Packaging",
                summary: "Label design and packaging system for an organic coffee roastery based in the Pacific Northwest. The design features hand-drawn botanical illustrations.",
                role: "Visual Designer. Created illustrations and print-ready package files.",
                tools: ["Adobe Illustrator", "Procreate"],
                process: ["Illustration sketches.", "Typography selection.", "Print proofs."]
            },
            es: {
                title: "Botanica Brews",
                category: "Packaging",
                summary: "Diseño de etiquetas y sistema de empaque para una tostaduría de café orgánico. El diseño presenta ilustraciones botánicas a mano.",
                role: "Diseñadora Visual. Creación de ilustraciones y archivos listos para impresión.",
                tools: ["Adobe Illustrator", "Procreate"],
                process: ["Bocetos de ilustración.", "Selección tipográfica.", "Pruebas de impresión."]
            }
        }
    },
    "kinetic-type": {
        slug: "kinetic-type",
        images: [1, 2, 3],
        content: {
            en: {
                title: "Kinetic Type Series",
                category: "Motion",
                summary: "An exploration of expressive typography through motion.",
                role: "Motion Designer.",
                tools: ["After Effects", "Cinema 4D"],
                process: ["Storyboarding.", "Animation.", "Sound design."]
            },
            es: {
                title: "Kinetic Type Series",
                category: "Motion",
                summary: "Una exploración de tipografía expresiva a través del movimiento.",
                role: "Diseñadora de Movimiento.",
                tools: ["After Effects", "Cinema 4D"],
                process: ["Guión gráfico.", "Animación.", "Diseño de sonido."]
            }
        }
    },
    "vantage-magazine": {
        slug: "vantage-magazine",
        images: [1, 2, 3],
        content: {
            en: {
                title: "Vantage Magazine",
                category: "Editorial",
                summary: "Layout and art direction for a quarterly lifestyle publication.",
                role: "Art Director.",
                tools: ["InDesign", "Grid Systems"],
                process: ["Layout grids.", "Photo selection.", "Typesetting."]
            },
            es: {
                title: "Vantage Magazine",
                category: "Editorial",
                summary: "Diseño y dirección de arte para una publicación trimestral de estilo de vida.",
                role: "Directora de Arte.",
                tools: ["InDesign", "Sistemas de grilla"],
                process: ["Grillas de diseño.", "Selección de fotos.", "Composición tipográfica."]
            }
        }
    },
    "city-icons": {
        slug: "city-icons",
        images: [1, 2, 3],
        content: {
            en: {
                title: "City Icons",
                category: "Illustration",
                summary: "A set of vector icons representing landmark buildings in Tulsa.",
                role: "Illustrator.",
                tools: ["Illustrator", "Vector Art"],
                process: ["Reference gathering.", "Sketching.", "Vectorization."]
            },
            es: {
                title: "City Icons",
                category: "Ilustración",
                summary: "Un set de iconos vectoriales representando edificios emblemáticos de Tulsa.",
                role: "Ilustradora.",
                tools: ["Illustrator", "Arte Vectorial"],
                process: ["Recopilación de referencias.", "Bocetaje.", "Vectorización."]
            }
        }
    }
};

document.addEventListener('DOMContentLoaded', () => {
    try {
        console.log('Portfolio script init...');

        // DOM Elements
        const langToggleBtn = document.getElementById('lang-toggle');
        const yearSpan = document.getElementById('year');
        const translatableElements = document.querySelectorAll('[data-i18n]');
        const htmlEl = document.documentElement;

        // Modal Elements
        const modal = document.getElementById('project-modal');
        const modalCloseTargets = document.querySelectorAll('[data-close]');
        const modalTitle = document.getElementById('modal-title');
        const modalCategory = document.getElementById('modal-category');
        const modalSummary = document.getElementById('modal-summary');
        const modalRole = document.getElementById('modal-role');
        const modalTools = document.getElementById('modal-tools');
        const modalProcess = document.getElementById('modal-process');
        const carouselTrack = document.getElementById('carousel-track');
        const carouselPrev = document.getElementById('carousel-prev');
        const carouselNext = document.getElementById('carousel-next');
        const carouselIndicator = document.getElementById('carousel-indicator');

        // State
        let currentLang = localStorage.getItem('portfolio_lang') || 'en';
        // Validate language
        if (!translations[currentLang]) {
            console.warn('Invalid language in localStorage, resetting to en');
            currentLang = 'en';
        }

        let currentProjectSlug = null;
        let currentSlideIndex = 0;
        let currentProjectImages = [];

        // Initialize
        setLanguage(currentLang);
        if (yearSpan) yearSpan.textContent = new Date().getFullYear();

        // Event Listeners - Language
        if (langToggleBtn) {
            langToggleBtn.addEventListener('click', () => {
                currentLang = currentLang === 'en' ? 'es' : 'en';
                setLanguage(currentLang);
                localStorage.setItem('portfolio_lang', currentLang);

                // If modal contains info, update it live
                if (currentProjectSlug) {
                    renderModalContent(currentProjectSlug);
                }
            });
        }

        // Event Listeners - Projects
        const projectCards = document.querySelectorAll('[data-project]');
        console.log(`Found ${projectCards.length} project cards`);

        projectCards.forEach(card => {
            card.addEventListener('click', (e) => {
                console.log('Card clicked', card.getAttribute('data-project'));
                const slug = card.getAttribute('data-project');
                openModal(slug);
            });

            // Keyboard accessibility for cards
            card.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const slug = card.getAttribute('data-project');
                    openModal(slug);
                }
            });
        });

        // Event Listeners - Modal
        modalCloseTargets.forEach(el => {
            el.addEventListener('click', closeModal);
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal && modal.getAttribute('aria-hidden') === 'false') {
                closeModal();
            }
            // Carousel Nav
            if (modal && modal.getAttribute('aria-hidden') === 'false') {
                if (e.key === 'ArrowLeft') showPrevSlide();
                if (e.key === 'ArrowRight') showNextSlide();
            }
        });

        if (carouselPrev) carouselPrev.addEventListener('click', showPrevSlide);
        if (carouselNext) carouselNext.addEventListener('click', showNextSlide);

        // Language Function
        function setLanguage(lang) {
            if (!translations[lang]) return;

            // Update HTML lang attribute
            htmlEl.setAttribute('lang', lang);

            // Update Text Content
            translatableElements.forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });

            // Update Toggle UI style
            if (langToggleBtn) {
                const opts = langToggleBtn.querySelectorAll('.lang-opt');
                opts.forEach(opt => {
                    if (opt.getAttribute('data-lang') === lang) {
                        opt.style.color = 'var(--color-text)';
                        opt.style.fontWeight = '700';
                    } else {
                        opt.style.color = 'var(--color-text-muted)';
                        opt.style.fontWeight = '400';
                    }
                });
            }
        }

        // Modal Functions
        function openModal(slug) {
            console.log('Opening modal for', slug);
            const project = projectsData[slug];
            if (!project) {
                console.error('Project data not found for', slug);
                return;
            }

            currentProjectSlug = slug;
            currentProjectImages = project.images;
            currentSlideIndex = 0;

            renderModalContent(slug);
            renderCarousel(slug, project.images);

            if (modal) {
                modal.setAttribute('aria-hidden', 'false');
                document.body.classList.add('no-scroll');

                // Trap focus to close button
                setTimeout(() => {
                    const closeBtn = document.querySelector('.modal-close');
                    if (closeBtn) closeBtn.focus();
                }, 50);
            }
        }

        function closeModal() {
            if (modal) modal.setAttribute('aria-hidden', 'true');
            document.body.classList.remove('no-scroll');
            currentProjectSlug = null;
        }

        function renderModalContent(slug) {
            if (!projectsData[slug]) return;
            const content = projectsData[slug].content[currentLang];
            if (!content) return;

            if (modalTitle) modalTitle.textContent = content.title;
            if (modalCategory) modalCategory.textContent = content.category;
            if (modalSummary) modalSummary.textContent = content.summary;
            if (modalRole) modalRole.textContent = content.role;

            // Tools
            if (modalTools) modalTools.innerHTML = content.tools.map(tool => `<li>${tool}</li>`).join('');

            // Process
            if (modalProcess) modalProcess.innerHTML = content.process.map(item => `<li>${item}</li>`).join('');
        }

        function renderCarousel(slug, images) {
            if (!carouselTrack) return;
            carouselTrack.innerHTML = '';

            images.forEach((imgNum, index) => {
                const li = document.createElement('li');
                li.classList.add('carousel-slide');
                if (index === 0) li.classList.add('active');

                // Image construct
                const imgPath = `assets/projects/${slug}/${imgNum}.jpg`;

                // Check for error logic in pure JS:
                const imgEl = document.createElement('img');
                imgEl.src = imgPath;
                imgEl.alt = `${slug} image ${index + 1}`;

                // Fallback content if image fails
                const fallbackEl = document.createElement('div');
                fallbackEl.className = 'carousel-fallback';
                fallbackEl.style.display = 'none';

                imgEl.onerror = () => {
                    console.log('Image failed to load:', imgPath);
                    imgEl.style.display = 'none';
                    fallbackEl.style.display = 'flex';
                };

                li.appendChild(imgEl);
                li.appendChild(fallbackEl);
                carouselTrack.appendChild(li);
            });

            updateCarouselUI();
        }

        function showPrevSlide() {
            if (currentProjectImages.length === 0) return;
            currentSlideIndex = (currentSlideIndex - 1 + currentProjectImages.length) % currentProjectImages.length;
            updateCarouselUI();
        }

        function showNextSlide() {
            if (currentProjectImages.length === 0) return;
            currentSlideIndex = (currentSlideIndex + 1) % currentProjectImages.length;
            updateCarouselUI();
        }

        function updateCarouselUI() {
            const slides = document.querySelectorAll('.carousel-slide');
            slides.forEach((slide, index) => {
                if (index === currentSlideIndex) {
                    slide.classList.add('active');
                } else {
                    slide.classList.remove('active');
                }
            });

            if (carouselIndicator) carouselIndicator.textContent = `${currentSlideIndex + 1} / ${currentProjectImages.length}`;
        }

        // Scroll Reveal Animation
        const revealElements = document.querySelectorAll('.reveal');

        if ('IntersectionObserver' in window) {
            const revealObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                        revealObserver.unobserve(entry.target); // Trigger once
                    }
                });
            }, {
                threshold: 0.15,
                rootMargin: "0px 0px -50px 0px"
            });

            revealElements.forEach(el => revealObserver.observe(el));
        } else {
            // Fallback for no observer
            revealElements.forEach(el => el.classList.add('active'));
        }

    } catch (err) {
        console.error('Critical script error:', err);
    }
});
